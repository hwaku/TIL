## Today's curiosity

---

### Spring Security_CSRF Token과 HTTPS 암호화 알고리즘

1. CSRF (Cross-Site Request Forgery)란?
    - 사이트 간 요청의 위조
    - 웹 애플리케이션의 취약점 중 하나
    - 웹 애플리케이션이 신뢰하는 사용자로부터 승인되지 않은 요청이 제출되는 공격 유형이다.
    - 사용자에 의도와 상관없이 공격자가 의도한 작업을 해서 특정 웹페이지를 보안에 취약하게
      한다거나 클라이언트 또는 서버 데이터 유출, 세션 상태 변경 또는 최종 사용자의 계정 조작등의
      작업을 하게 만들 수 있다.
    - ex) 사용자가 정상적으로 로그인을 하고 권한을 획득할 때 공격자가 몰래 자신이 만든 페이지로 피싱
      사이트를 하나 만들어 사용자가 접속하게 유도한다. 접속 URL이 변경되겠지만 아주 미묘한 차이이고 화면이
      완전 동일하게 만들어져있어 사용자는 의심없이 정보를 입력하게된다. 정보를 입력하면 서버에 요청을 보내는데
      여기서 실제 서버에 요청되는 내용은 Hidden 타입으로 공격자가 심어둔 데이터가 된다.
---
2. CSRF Token이란?
    - CSRF 취약 리소스를 보호하기 위해 서버 측 응용 프로그램이 생성하는 암호화 된 값을 말한다.


3. CSRF Token의 작동
    - 사용자의 매 요청마다 임의의 난수 값을 포함시켜 전송 및 세션에 저장하고 요청하는 페이지에 해당 토큰
      검증을 통하여 CSRF 공격을 방어한다.


4. CSRF Token을 중간에 탈취할 수 있지 않을까?
    - 해커는 응답 객체에 담긴 정보자체는 HTTPS 유선네트워크 상 탈취할 수 없다. 탈취한다고 해도 암호화 되어
      있기 때문이다. 하지만 평문으로 통신하는 무선네트워크는 정보를 탈취할 수 있으니 공개 네트워크는 조심해야
      한다.
    - 그래서 Token을 탈취하여 요청을 조작한다. 하지만 훨씬 고도화된 작업을 통하여 해독이 가능하다. 만약
      CSRF Token이 없다면 로그인하여 마구잡이로 정보를 빼올 수 있다는 점에서 보안이 강화된 부분은 맞다.

---

5. CSRF Token을 방어하는 방법 [참고자료[1]](https://en.wikipedia.org/wiki/Cross-site_request_forgery) [[2]](https://minkukjo.github.io/cs/2020/08/15/Security-1/) [[3]](https://zzang9ha.tistory.com/341) [[4]](https://docs.spring.io/spring-security/site/docs/5.3.x/reference/html5/#csrf) [[5]](https://www.neuralegion.com/blog/csrf-token/) [[6]](https://codevang.tistory.com/282)
    1. Https
        - Https (HyperText Tranfer Protocol over Secure Socket Layer)란 HTTP의 보안이 강화된 버전이다.
        - SSL (Secure Socket Layer)은 웹사이트와 브라우저, 서버 사이에 전송된 데이터를 암호화하여 인터넷
          연결 보안을 유지하는 표준 기술이다.
        - TLS (Trasport Layer Security)는 SSL이 표준화 되면서 바뀐 이름이다.


2. TLS의 기본 절차
    - [위키백과](https://ko.wikipedia.org/wiki/%EC%A0%84%EC%86%A1_%EA%B3%84%EC%B8%B5_%EB%B3%B4%EC%95%88) 에 설명된 내용이다.
   >우선 첫 단계에서 서버와 클라이언트는 암호 스위트를 교환한다. 이 단계에서 키 교환과 인증에 사용될
   > 암호화 방법, 메시지 인증 코드(MAC)가 결정된다. 키 교환과 인증 알고리즘은 공개키 방법을 사용하거나
   > 미리 공유된 키(TLS-PSK)를 사용할 수도 있다. 메시지 인증 코드들은 HMAC 해시 함수로 만든다.
   > SSL에서는 비표준 무작위 함수를 사용한다.
    - 대표적인 암호화 알고리즘은 단방향 암호화, 대칭 키, 비대칭 키가 있다.
    - 단방향 암호화 : 흔히 Hash를 이용해 암호화를 하는것으로, 임의의 평문을 hash 처리하였을때 그
      복호화가 불가능한 암호 알고리즘이다. Hash 처리된 암호문을 평문으로 복호화하는 것은 불가능하므로,
      단방향 암호라고 부르며 패스워드 등에 사용된다.
    - 대칭키 : 암호화와 복호화에 같은 암호키를 사용하는 암호화 알고리즘이다.
   ```text
   대칭키는 암호키를 수신자에게 미리 안전하게 전달해야한다. 그래야 수신자가 복호화할 수 있다.
   대칭키는 암호키를 어떻게 안전하게 전달하느냐가 딜레마이다.
   ```
    - 비대칭 키 : 암호화와 복호화에 다른 암호 키를 사용하는 암호화 알고리즘이다. 해독키(개인키, Private Key)
      는 노출이 되어선 안되는 키이고 이 키를 토대로 만든 암호화키(공개키, Public Key)가 한쌍 이다.
   ```text
   평문 > 공개키 사용 암호화 > 암호문 > 개인키 사용 복호화 > 평문
   평문 > 개인키 사용 암호화 > 암호문 > 공개키 사용 복호화 > 평문
   
   비대칭 키는 위와 같은 특징을 갖는다.
   ```
    - 현재는 HTTPS에서 대칭키와 비대칭키를 교묘하게 이용하여 사용하고있다.
   ```text
   handshaking 과정에서 클라이언트가 서버에게 연결을 요청하면 서버는 클라이언트에게 서버에 대칭키를
   보내준다. 그리고 서버 인증서에 대해 신뢰 기관 발급 여부를 확인하고 통과하면 서버가 준 대칭키로
   세션 키를 암호화한다. 그 후 암호화 한 텍스트를 서버에 보낸다. 그러면 세션 키는 그대로 있고 세션 키(대칭키)를
   암호화한 텍스트가 넘어간다. 세션 키(대칭키)를 암호화한 텍스트가 서버로 가면 서버에서는 Private Key를 풀어서
   세션 키를 알게된다. 이제는 대칭키를 사용하고 서로 가지고 있는 세션 키로 암호화하고 복호화하기 때문에
   더 이상 비대칭키를 사용할 필요가 없다.
   ```
    - 비대칭키는 RSA 암호 체계를 흔히 사용하고있다. [참고자료[1]](https://m.blog.naver.com/dcganga/221606509228)
   ```text
   RSA 암호 알고리즘의 핵심은 큰 정수의 소인수 분해가 어렵다는 점을 이용해 암호화를 시킨다.
   ```